<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dama Online - Profesyonel</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700;900&display=swap');
        *{margin:0;padding:0;box-sizing:border-box}
        body{background:linear-gradient(135deg,#0d0d2b,#1a1a4d);color:#fff;font-family:'Exo 2',sans-serif;display:flex;justify-content:center;align-items:center;min-height:100vh;overflow:hidden;position:relative}
        body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at 50% 50%,rgba(100,200,255,0.15),transparent 70%);pointer-events:none;animation:sparkle 3s infinite}
        @keyframes sparkle{0%,100%{opacity:0}50%{opacity:1}}
        #container{background:rgba(10,10,40,0.9);backdrop-filter:blur(15px);padding:30px;border-radius:25px;box-shadow:0 0 40px rgba(100,200,255,0.4);text-align:center;max-width:800px;width:95%;position:relative}
        h1{font-size:3.5em;margin-bottom:20px;background:linear-gradient(45deg,#00ffea,#0099ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-shadow:0 0 20px rgba(0,255,234,0.5)}
        #status{font-size:1.3em;margin:20px 0;color:#00ffea}
        button{padding:16px 40px;margin:10px;font-size:1.4em;background:linear-gradient(45deg,#00ffea,#0066ff);border:none;border-radius:50px;color:#000;font-weight:900;cursor:pointer;transition:.3s;box-shadow:0 10px 30px rgba(0,200,255,0.4)}
        button:hover{transform:translateY(-6px);box-shadow:0 15px 40px rgba(0,200,255,0.6)}
        button:disabled{opacity:0.5;cursor:not-allowed;transform:none}
        #lobby{margin:30px 0;display:none}
        #roomCode{font-size:3em;font-weight:900;color:#00ffea;letter-spacing:5px;margin:20px 0;font-family:monospace}
        #progress{width:100%;height:12px;background:#333;border-radius:6px;overflow:hidden;margin:15px 0}
        #bar{height:100%;width:0%;background:linear-gradient(90deg,#00ffea,#0066ff);transition:width .4s;animation:pulse 2s infinite}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.7}}
        .note{font-size:0.9em;color:#aaa;margin-top:20px}
        #board{display:none;grid-template-columns:repeat(8,60px);grid-template-rows:repeat(8,60px);border:3px solid #00ffea;border-radius:15px;margin:20px auto;box-shadow:0 0 30px rgba(0,255,234,0.5)}
        .cell{width:60px;height:60px;display:flex;justify-content:center;align-items:center;position:relative;transition:all .3s;cursor:pointer}
        .light{background:#f0f0f0}.dark{background:#333}
        .piece{width:50px;height:50px;border-radius:50%;cursor:pointer;position:absolute;transition:all .5s ease;box-shadow:0 5px 15px rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;font-size:20px}
        .piece:hover{transform:scale(1.1)}
        .red{background:radial-gradient(#ff6b6b,#ff4757);border:2px solid #c44569}.black{background:radial-gradient(#2f3542,#1a1a2e);border:2px solid #1a1a2e}
        .king{border:3px solid gold;box-shadow:0 0 10px gold}
        .possible{background:rgba(0,255,0,0.5)!important;transform:scale(1.05)}
        .turn-glow{box-shadow:inset 0 0 20px rgba(0,255,234,0.8)}
        #gameStatus{font-size:1.5em;margin:10px;color:#00ffea}
        @media(max-width:600px){#board{grid-template-columns:repeat(8,40px);grid-template-rows:repeat(8,40px)}.piece{width:30px;height:30px;font-size:14px}}
    </style>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>
    <div id="container">
        <h1>DAMA ONLINE</h1>
        <div id="status">Sunucuya baÄŸlanÄ±lÄ±yor...</div>
        <button id="ranked">Dereceli Oyna</button>
        <button id="private">ArkadaÅŸla Oyna</button>

        <div id="lobby">
            <div id="lobbyText">EÅŸleÅŸme aranÄ±yor...</div>
            <div id="progress"><div id="bar"></div></div>
            <div id="roomCode"></div>
            <div class="note">ArkadaÅŸÄ±n aynÄ± kodu girsin</div>
        </div>

        <div id="board"></div>
        <div id="gameStatus"></div>
    </div>

    <script>
        const socket = io('https://mario-io-1.onrender.com',{transports:['websocket']});
        let myName = 'Guest'+Math.floor(1000+Math.random()*9000);
        let gameId = null, color = null, isMyTurn = false, selected = null, board = [];
        const rows=8, cols=8;

        socket.on('connect',()=>{document.getElementById('status').textContent='BaÄŸlandÄ± â€“ HoÅŸ geldin '+myName+'!'});
        socket.on('disconnect',()=>{document.getElementById('status').textContent='BaÄŸlantÄ± koptu...';});

        function showLobby(text,code=''){
            document.getElementById('lobby').style.display='block';
            document.getElementById('lobbyText').textContent=text;
            document.getElementById('roomCode').textContent=code;
            document.getElementById('roomCode').style.display=code?'block':'none';
            document.getElementById('ranked').disabled=document.getElementById('private').disabled=true;
            let w=0; const int=setInterval(()=>{w=(w+5)%100;document.getElementById('bar').style.width=w+'%'},100);
            socket.once('gameStart',()=>{clearInterval(int);document.getElementById('lobby').style.display='none';});
        }

        document.getElementById('ranked').onclick=()=>{
            showLobby('Dereceli eÅŸleÅŸme aranÄ±yor...');
            socket.emit('joinQueue',myName);
        };

        document.getElementById('private').onclick=()=>{
            showLobby('Oda oluÅŸturuluyor...');
            socket.emit('createPrivateRoom',myName);
        };

        socket.on('privateRoomCreated',(code)=>{
            document.getElementById('lobbyText').textContent='ArkadaÅŸÄ±nÄ± bekliyoruz!';
            document.getElementById('roomCode').textContent=code;
            document.getElementById('roomCode').style.display='block';
        });

        socket.on('askPrivateCode',()=>{
            const code = prompt('4 haneli oda kodunu gir:').trim();
            if(code && code.length===4 && /^\d{4}$/.test(code)) socket.emit('joinPrivateRoom',{name:myName,code});
            else alert('GeÃ§ersiz kod! 4 rakam gir.');
        });

        socket.on('gameStart',(data)=>{
            gameId=data.gameId; color=data.color; isMyTurn=color==='red';
            document.getElementById('board').style.display='grid';
            initBoard();
            document.getElementById('gameStatus').textContent=isMyTurn?'SÄ±ra sende!':'Rakibin sÄ±rasÄ±...';
            highlightTurn();
        });

        socket.on('move',(data)=>{
            board = data.board;
            isMyTurn = data.currentPlayer === color;
            renderBoard();
            document.getElementById('gameStatus').textContent=isMyTurn?'SÄ±ra sende!':'Rakibin sÄ±rasÄ±...';
            highlightTurn();
        });

        socket.on('error',msg=>alert(msg));

        function initBoard(){
            const b=document.getElementById('board'); b.innerHTML='';
            board=Array.from({length:rows},()=>Array(cols).fill(null));
            for(let r=0;r<rows;r++){
                for(let c=0;c<cols;c++){
                    const cell=document.createElement('div');
                    cell.classList.add('cell',(r+c)%2?'dark':'light');
                    cell.dataset.row=r; cell.dataset.col=c;
                    cell.onclick=handleClick;
                    b.appendChild(cell);
                    if(r<3 && (r+c)%2) placePiece(r,c,'black');
                    if(r>4 && (r+c)%2) placePiece(r,c,'red');
                }
            }
        }

        function placePiece(r,c,clr,isKing=false){
            const cell=document.querySelector(`[data-row="${r}"][data-col="${c}"]`);
            const p=document.createElement('div');
            p.classList.add('piece',clr);
            p.innerHTML=isKing?'ðŸ‘‘':clr==='red'?'ðŸ”´':'âš«';
            p.onclick=e=>{e.stopPropagation();if(isMyTurn && clr===color){selectPiece(r,c);}}
            cell.appendChild(p);
            board[r][c]={color:clr,king:isKing};
        }

        function selectPiece(r,c){
            clearHighlights();
            selected={r,c};
            const moves=getMoves(r,c);
            moves.forEach(([tr,tc])=>{
                document.querySelector(`[data-row="${tr}"][data-col="${tc}"]`).classList.add('possible');
            });
        }

        function handleClick(e){
            if(!selected || !isMyTurn) return;
            const tr=+e.target.dataset.row, tc=+e.target.dataset.col;
            const {r:fr,c:fc}=selected;
            const moves=getMoves(fr,fc);
            if(moves.some(([mr,mc])=>mr===tr&&mc===tc)){
                animateMove(fr,fc,tr,tc);
                movePiece(fr,fc,tr,tc);
                clearHighlights(); selected=null;
                socket.emit('move',{gameId,board,currentPlayer:isMyTurn?color:'opponent'});
                isMyTurn=false;
                document.getElementById('gameStatus').textContent='Rakibin sÄ±rasÄ±...';
                checkWin();
            }
        }

        function getMoves(r,c){
            const piece=board[r][c], dir=piece.color==='red'?-1:1, isKing=piece.king;
            const moves=[], dirs=isKing?[[-1,-1],[-1,1],[1,-1],[1,1]]:[[dir,-1],[dir,1]];
            dirs.forEach(([dr,dc])=>{
                let nr=r+dr,nc=c+dc;
                if(nr>=0&&nr<rows&&nc>=0&&nc<cols&&!board[nr][nc]) moves.push([nr,nc]);
                else if(nr>=0&&nr<rows&&nc>=0&&nc<cols&&board[nr][nc]&&board[nr][nc].color!==piece.color){
                    nr+=dr;nc+=dc;
                    if(nr>=0&&nr<rows&&nc>=0&&nc<cols&&!board[nr][nc]) moves.push([nr,nc]);
                }
            });
            const jumps=moves.filter(([nr,nc])=>Math.abs(nr-r)===2);
            return jumps.length?jumps:moves;
        }

        function movePiece(fr,fc,tr,tc){
            board[tr][tc]=board[fr][fc]; board[fr][fc]=null;
            if(Math.abs(tr-fr)===2){
                const mr=(fr+tr)/2,mc=(fc+tc)/2;
                board[mr][mc]=null;
            }
            const piece=board[tr][tc];
            if((piece.color==='red'&&tr===0)||(piece.color==='black'&&tr===7)) piece.king=true;
            renderBoard();
        }

        function animateMove(fr,fc,tr,tc){
            const piece=document.querySelector(`[data-row="${fr}"][data-col="${fc}"] .piece`);
            const fromRect=piece.getBoundingClientRect();
            const toCell=document.querySelector(`[data-row="${tr}"][data-col="${tc}"]`);
            piece.style.position='fixed'; piece.style.zIndex=1000; piece.style.left=fromRect.left+'px'; piece.style.top=fromRect.top+'px';
            setTimeout(()=>{piece.style.transition='all 0.5s ease'; piece.style.left=toCell.getBoundingClientRect().left+'px'; piece.style.top=toCell.getBoundingClientRect().top+'px';},10);
            setTimeout(()=>{piece.style.position=''; piece.style.left=''; piece.style.top=''; piece.style.transition='';},550);
        }

        function renderBoard(){
            document.querySelectorAll('.cell').forEach(cell=>{
                cell.innerHTML='';
                const r=+cell.dataset.row,c=+cell.dataset.col;
                if(board[r][c]) placePiece(r,c,board[r][c].color,board[r][c].king);
            });
        }

        function clearHighlights(){document.querySelectorAll('.possible').forEach(el=>el.classList.remove('possible'));}

        function highlightTurn(){
            document.querySelectorAll('.cell').forEach(cell=>cell.classList.remove('turn-glow'));
            const start=color==='red'?5:0, end=color==='red'?8:3;
            for(let r=start;r<end;r++) for(let c=0;c<8;c++) document.querySelector(`[data-row="${r}"][data-col="${c}"]`)?.classList.add('turn-glow');
        }

        function checkWin(){
            const reds=board.flat().filter(p=>p&&p.color==='red').length;
            const blacks=board.flat().filter(p=>p&&p.color==='black').length;
            if(reds===0||blacks===0){
                alert(blacks===0?'KÄ±rmÄ±zÄ± kazandÄ±!':'Siyah kazandÄ±!');
                location.reload();
            }
        }
    </script>
</body>
</html>
