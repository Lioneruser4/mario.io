<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Online Checkers</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            font-family: 'Roboto', sans-serif;
            color: #fff;
        }
        #game-container {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        #board {
            display: grid;
            grid-template-columns: repeat(8, 60px);
            grid-template-rows: repeat(8, 60px);
            border: 4px solid #fff;
            margin: 20px auto;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }
        .cell {
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            transition: background-color 0.3s ease;
        }
        .black {
            background-color: #4a4a4a;
        }
        .white {
            background-color: #e0e0e0;
        }
        .piece {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            position: absolute;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }
        .piece:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.6);
        }
        .red {
            background: radial-gradient(circle, #ff416c, #ff4b2b);
            border: 2px solid #d32f2f;
        }
        .black-piece {
            background: radial-gradient(circle, #434343, #000000);
            border: 2px solid #212121;
        }
        .king {
            border: 4px solid gold;
            box-shadow: 0 0 10px gold;
        }
        .possible-move {
            background-color: rgba(0, 255, 0, 0.4) !important;
            transform: scale(1.05);
            transition: transform 0.2s ease;
        }
        .turn-highlight {
            box-shadow: inset 0 0 15px 5px rgba(255, 255, 0, 0.5);
        }
        #status {
            margin: 15px 0;
            font-size: 1.2em;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }
        button {
            padding: 12px 24px;
            font-size: 1.1em;
            margin: 10px;
            cursor: pointer;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.5);
        }
        button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        #lobby {
            display: none;
            font-size: 1.2em;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }
        /* Animasyonlu Hareket için */
        .moving {
            transition: top 0.5s ease, left 0.5s ease;
        }
    </style>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>
    <div id="game-container">
        <h1>Professional Online Checkers</h1>
        <button id="ranked-play">Dereceli Oyna</button>
        <div id="lobby">Eşleşme Aranıyor...</div>
        <div id="board" style="display: none;"></div>
        <div id="status"></div>
    </div>

    <script>
        // Socket.io Bağlantısı
        const socket = io('https://mario-io-1.onrender.com', { transports: ['websocket'] });

        // Oyun Durumları
        let board = [];
        let currentPlayer = 'red'; // Kırmızı başlar
        let selectedPiece = null;
        let playerColor = null;
        let gameId = null;
        let isMyTurn = false;

        // Tahta Oluştur
        function initBoard() {
            const boardElement = document.getElementById('board');
            boardElement.innerHTML = '';
            board = Array.from({length: 8}, () => Array(8).fill(null));

            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell', (row + col) % 2 === 0 ? 'white' : 'black');
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    cell.addEventListener('click', handleCellClick);
                    boardElement.appendChild(cell);

                    if (row < 3 && (row + col) % 2 !== 0) {
                        placePiece(row, col, 'black');
                    } else if (row > 4 && (row + col) % 2 !== 0) {
                        placePiece(row, col, 'red');
                    }
                }
            }
            boardElement.style.display = 'grid';
        }

        function placePiece(row, col, color) {
            const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            const piece = document.createElement('div');
            piece.classList.add('piece', color === 'red' ? 'red' : 'black-piece');
            piece.dataset.color = color;
            piece.dataset.king = 'false';
            piece.addEventListener('click', handlePieceClick);
            cell.appendChild(piece);
            board[row][col] = { color, king: false };
        }

        // Taş Seçimi
        function handlePieceClick(e) {
            e.stopPropagation();
            if (!isMyTurn || e.target.dataset.color !== playerColor) return;

            clearHighlights();
            selectedPiece = e.target;
            const row = parseInt(selectedPiece.parentElement.dataset.row);
            const col = parseInt(selectedPiece.parentElement.dataset.col);
            highlightPossibleMoves(row, col);
        }

        // Hücre Tıklama (Hareket)
        function handleCellClick(e) {
            if (!selectedPiece || !isMyTurn) return;

            const fromRow = parseInt(selectedPiece.parentElement.dataset.row);
            const fromCol = parseInt(selectedPiece.parentElement.dataset.col);
            const toRow = parseInt(e.currentTarget.dataset.row);
            const toCol = parseInt(e.currentTarget.dataset.col);

            if (isValidMove(fromRow, fromCol, toRow, toCol)) {
                animateMove(fromRow, fromCol, toRow, toCol, () => {
                    movePiece(fromRow, fromCol, toRow, toCol);
                    clearHighlights();
                    selectedPiece = null;
                    switchTurn();
                    updateGameState();
                    checkWin();
                });
            }
        }

        // Animasyonlu Hareket
        function animateMove(fromRow, fromCol, toRow, toCol, callback) {
            const piece = selectedPiece;
            piece.classList.add('moving');
            const fromCell = piece.parentElement;
            const toCell = document.querySelector(`[data-row="${toRow}"][data-col="${toCol}"]`);

            // Pozisyon hesapla
            const fromRect = fromCell.getBoundingClientRect();
            const toRect = toCell.getBoundingClientRect();
            const dx = toRect.left - fromRect.left;
            const dy = toRect.top - fromRect.top;

            piece.style.position = 'absolute';
            piece.style.left = '0';
            piece.style.top = '0';
            piece.style.transform = `translate(${dx}px, ${dy}px)`;

            setTimeout(() => {
                piece.style.transform = '';
                piece.style.position = '';
                piece.classList.remove('moving');
                callback();
            }, 500);
        }

        // Mümkün Hareketleri Göster
        function highlightPossibleMoves(row, col) {
            const piece = board[row][col];
            const direction = piece.color === 'red' ? -1 : 1;
            const moves = getPossibleMoves(row, col, direction, piece.king);

            moves.forEach(([r, c]) => {
                const cell = document.querySelector(`[data-row="${r}"][data-col="${c}"]`);
                cell.classList.add('possible-move');
            });
        }

        function getPossibleMoves(row, col, direction, isKing) {
            const moves = [];
            const dirs = [[direction, -1], [direction, 1]];
            if (isKing) dirs.push([-direction, -1], [-direction, 1]);

            dirs.forEach(([dr, dc]) => {
                let r = row + dr, c = col + dc;
                if (r >= 0 && r < 8 && c >= 0 && c < 8 && !board[r][c]) {
                    moves.push([r, c]);
                } else if (r >= 0 && r < 8 && c >= 0 && c < 8 && board[r][c] && board[r][c].color !== piece.color) {
                    r += dr; c += dc;
                    if (r >= 0 && r < 8 && c >= 0 && c < 8 && !board[r][c]) {
                        moves.push([r, c]);
                    }
                }
            });

            const captures = moves.filter(m => Math.abs(m[0] - row) === 2);
            return captures.length > 0 ? captures : moves;
        }

        function isValidMove(fromRow, fromCol, toRow, toCol) {
            const piece = board[fromRow][fromCol];
            const direction = piece.color === 'red' ? -1 : 1;
            const moves = getPossibleMoves(fromRow, fromCol, direction, piece.king);
            return moves.some(([r, c]) => r === toRow && c === toCol);
        }

        // Taş Hareket Ettir (Animasyondan sonra)
        function movePiece(fromRow, fromCol, toRow, toCol) {
            const piece = board[fromRow][fromCol];
            board[toRow][toCol] = piece;
            board[fromRow][fromCol] = null;

            const cellFrom = document.querySelector(`[data-row="${fromRow}"][data-col="${fromCol}"]`);
            const cellTo = document.querySelector(`[data-row="${toRow}"][data-col="${toCol}"]`);
            cellTo.appendChild(cellFrom.firstChild);

            // Yeme
            if (Math.abs(toRow - fromRow) === 2) {
                const midRow = (fromRow + toRow) / 2;
                const midCol = (fromCol + toCol) / 2;
                board[midRow][midCol] = null;
                const midCell = document.querySelector(`[data-row="${midRow}"][data-col="${midCol}"]`);
                midCell.innerHTML = '';
            }

            // Kral Olma
            if ((piece.color === 'red' && toRow === 0) || (piece.color === 'black' && toRow === 7)) {
                piece.king = true;
                cellTo.firstChild.classList.add('king');
                cellTo.firstChild.dataset.king = 'true';
            }
        }

        function clearHighlights() {
            document.querySelectorAll('.possible-move').forEach(el => el.classList.remove('possible-move'));
        }

        // Sıra Değiştir
        function switchTurn() {
            currentPlayer = currentPlayer === 'red' ? 'black' : 'red';
            isMyTurn = currentPlayer === playerColor;
            updateTurnHighlight();
            document.getElementById('status').textContent = isMyTurn ? 'Sıra Sende!' : 'Rakibin Sırası...';
        }

        function updateTurnHighlight() {
            document.querySelectorAll('.cell').forEach(cell => cell.classList.remove('turn-highlight'));
            const startRow = currentPlayer === 'red' ? 5 : 0;
            const endRow = currentPlayer === 'red' ? 8 : 3;
            for (let row = startRow; row < endRow; row++) {
                for (let col = 0; col < 8; col++) {
                    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                    if (cell) cell.classList.add('turn-highlight');
                }
            }
        }

        // Kazanma Kontrolü
        function checkWin() {
            const redPieces = board.flat().filter(p => p && p.color === 'red').length;
            const blackPieces = board.flat().filter(p => p && p.color === 'black').length;
            if (redPieces === 0) {
                alert('Siyah Kazandı!');
                endGame();
            } else if (blackPieces === 0) {
                alert('Kırmızı Kazandı!');
                endGame();
            }
        }

        function endGame() {
            socket.emit('endGame', gameId);
            document.getElementById('board').style.display = 'none';
            document.getElementById('status').textContent = 'Oyun Bitti!';
            document.getElementById('ranked-play').disabled = false;
        }

        // Multiplayer İşlemleri
        document.getElementById('ranked-play').addEventListener('click', startMatchmaking);

        function startMatchmaking() {
            document.getElementById('lobby').style.display = 'block';
            document.getElementById('ranked-play').disabled = true;
            socket.emit('joinQueue');
        }

        socket.on('gameStart', (data) => {
            gameId = data.gameId;
            playerColor = data.color;
            initBoard();
            document.getElementById('lobby').style.display = 'none';
            isMyTurn = playerColor === 'red';
            updateTurnHighlight();
            document.getElementById('status').textContent = isMyTurn ? 'Sıra Sende!' : 'Rakibin Sırası...';
        });

        socket.on('updateState', (data) => {
            board = data.board;
            currentPlayer = data.currentPlayer;
            isMyTurn = currentPlayer === playerColor;
            renderBoardFromState();
            updateTurnHighlight();
            document.getElementById('status').textContent = isMyTurn ? 'Sıra Sende!' : 'Rakibin Sırası...';
            checkWin();
        });

        function updateGameState() {
            socket.emit('move', { gameId, board, currentPlayer });
        }

        function renderBoardFromState() {
            document.querySelectorAll('.cell').forEach(cell => {
                cell.innerHTML = '';
                const row = parseInt(cell.dataset.row);
                const col = parseInt(cell.dataset.col);
                if (board[row][col]) {
                    placePiece(row, col, board[row][col].color);
                    if (board[row][col].king) {
                        cell.firstChild.classList.add('king');
                        cell.firstChild.dataset.king = 'true';
                    }
                }
            });
        }

        socket.on('connect', () => console.log('Sunucuya bağlandı!'));
        socket.on('disconnect', () => console.log('Sunucudan ayrıldı.'));
    </script>
</body>
</html>
